"use strict";angular.module("ohtuProjektiAppApp",["ngAnimate","LocalStorageModule","ngResource","ngSanitize","ngTouch","ui.router","ui.bootstrap","multi-select"]).config(["$stateProvider","$urlRouterProvider","$httpProvider",function(a,b){b.otherwise("/main"),a.state("main",{url:"/main",views:{"":{templateUrl:"scripts/main/main.html",controller:"IssueboardCtrl"},"header@":{controller:"HeaderCtrl",templateUrl:"scripts/header/header.html"}}}).state("logout",{url:"/logout",views:{"":{templateUrl:"scripts/user/logout.html",controller:"LogoutCtrl"},"header@":{controller:"HeaderCtrl",templateUrl:"scripts/header/header.html"}}}).state("list",{url:"/list",views:{"":{templateUrl:"scripts/list/list.html",controller:"ListCtrl"},"header@":{controller:"HeaderCtrl",templateUrl:"scripts/header/header.html"}}}).state("repository",{url:"/repos/:owner/:repoName",views:{"":{templateUrl:"scripts/issueboard/issueboard.html",controller:"IssueboardCtrl"},"header@":{controller:"HeaderCtrl",templateUrl:"scripts/header/header.html"},"newissue@repository":{templateUrl:"scripts/issueboard/newissue.html",controller:"NewissueCtrl"},"newlabel@repository":{templateUrl:"scripts/issueboard/newlabel.html",controller:"NewlabelCtrl"}}}).state("burndown",{url:"/repos/:owner/:repoName/burndown",views:{"":{templateUrl:"scripts/burndown/burndown.html",controller:"BurndownCtrl"},"header@":{controller:"HeaderCtrl",templateUrl:"scripts/header/header.html"}}})}]),angular.module("ohtuProjektiAppApp").controller("LoginCtrl",["$scope","$state","github","auth",function(a,b,c,d){a.signin=function(){var e=d.askAuth();e.done(function(d){c.loginWithToken(d.access_token),b.go("main",{},{reload:!0}),a.$apply()}).fail(function(a){console.log(a)})}}]),angular.module("ohtuProjektiAppApp").controller("LogoutCtrl",["github","$state",function(a,b){a.logout(),b.go("main")}]);var myApp=angular.module("ohtuProjektiAppApp");myApp.controller("MainCtrl",["$scope","$state","github",function(a,b,c){b.go(c.isAuthenticated()?"list":"login")}]),angular.module("ohtuProjektiAppApp").controller("ListCtrl",["$scope","$state","github",function(a,b,c){c.isAuthenticated()||b.go("main"),c.userRepos().success(function(b){a.repos=b})}]),angular.module("ohtuProjektiAppApp").controller("HeaderCtrl",["$rootScope","$scope","$location","github","$state","$stateParams",function(a,b,c,d,e){b.currentState=e.current.name,b.params=e.params,b.isLoggedIn=d.isAuthenticated(),b.options=["New issue","New label/Delete label","New milestone"],b.getClass=function(a,b){return b=b||c.path(),b.substr(0,a.length)==a?"active":""},b.doAction=function(b){a.$broadcast("addItem",{choice:b})}}]),angular.module("ohtuProjektiAppApp").controller("IssueboardCtrl",["$scope","$state","$stateParams","github","$modal",function(a,b,c,d,e){d.isAuthenticated()||b.go("main"),a.options={realtime:d.realtime()};var f=new d.Issue(c.owner,c.repoName),g=new d.Milestone(c.owner,c.repoName),h=new d.Label(c.owner,c.repoName);a.createOptions=["New issue","New label/Delete label","New milestone"],h.list().success(function(b){a.labels=b}),g.list().success(function(b){a.milestones=b}),f.list().success(function(b){b.editing=!1,a.issues=b,a.init()}),a.editItem=function(a){a.editingbody=a.body,a.editing=!0},a.cancelEditing=function(a){a.editing=!1},a.doneEditing=function(a){var b=a.body;a.body=a.editingbody,f.updateIssue(a.number,{body:a.body}).error(function(){a.body=b}),a.editing=!1},a.changedMilestone=function(a,b){f.updateIssue(a.number,{milestone:a.milestone.number},function(){},function(){a.milestone=b}),a.editing=!1},a.changedLabel=function(a,b){f.updateIssue(a.number,{labels:a.labels},function(){},function(){a.labels=b}),a.editing=!1},a.getLabelColor=function(a){return 0===a.labels.length?"":"#"+a.labels[0].color},a.isInBacklog=function(a){for(var b=0,c=0;c<a.labels.length;c++)(a.labels[c].name.match("Ready")||a.labels[c].name.match("InProgress")||a.labels[c].name.match("Done"))&&b++;return 0===b?a:void 0},a.isReady=function(){for(var a=0;a<issue.labels.length;a++)if(issue.labels[a].name.match("Ready"))return issue},a.isInProgress=function(a){for(var b=0;b<a.labels.length;b++)if(a.labels[b].name.match("InProgress"))return a},a.isDone=function(a){for(var b=0;b<a.labels.length;b++)if(a.labels[b].name.match("Done"))return a},a.openModal=function(b){"New issue"===b&&a.openNewIssueModal(),"New label/Delete label"===b&&a.openNewLabelModal(),"New milestone"===b&&console.log(b+"3")},a.openNewIssueModal=function(){e.open({templateUrl:"scripts/issueboard/newissue.html",controller:"NewissueCtrl",scope:a})},a.openNewLabelModal=function(){e.open({templateUrl:"scripts/issueboard/newlabel.html",controller:"NewlabelCtrl",scope:a})},a.init=function(){a.filtersGrouped=[],a.filtersGrouped.push({name:"<strong>Milestones</strong>",multiSelectGroup:!0});for(var b=0;b<a.milestones.length;b++){var c=a.milestones[b].title;a.filtersGrouped.push({name:c,ticked:!0,type:"milestone"})}a.filtersGrouped.push({multiSelectGroup:!1}),a.filtersGrouped.push({name:"<strong>Labels</strong>",multiSelectGroup:!0});for(var b=0;b<a.labels.length;b++){var d=a.labels[b].name;a.filtersGrouped.push({name:d,ticked:!0,type:"label"})}a.filtersGrouped.push({multiSelectGroup:!1})},a.updateRealtime=function(){d.realtime(a.options.realtime)},a.$on("addItem",function(b,c){a.openModal(c.choice)})}]),angular.module("ohtuProjektiAppApp").service("auth",function(){return OAuth.initialize("CHkmXQc9pfI3vqPZectNDagrwSc"),{askAuth:function(){return OAuth.popup("github")}}}),angular.module("ohtuProjektiAppApp").service("github",["$http","localStorageService",function(a,b){function c(c,f,g,h,i){var j={method:c,url:d+f,data:g,cache:!1},k=b.get("token");e.realtime()&&"GET"===c&&(j.params={cache:(new Date).getTime()}),k&&(j.headers={Authorization:"token "+k});var l=a(j);return h?void(i?l.success(h).error(i):l.success(h)):l}var d="https://api.github.com",e={realtime:function(a){return"undefined"==typeof a?angular.fromJson(b.get("realtime")):void b.set("realtime",a)},loginWithToken:function(a){b.set("token",a)},logout:function(){b.remove("token")},isAuthenticated:function(){return!!b.get("token")},user:function(a,b,d){return c("GET","/users/"+a,null,b,d)},authenticatedUser:function(a,b){return c("GET","/user",null,a,b)},userRepos:function(a,b){return c("GET","/user/repos",null,a,b)},Issue:function(a,b){var d="/repos/"+a+"/"+b+"/issues";this.list=function(a,b,e){return c("GET",d,a||{},b,e)},this.getIssue=function(a,b,e){return c("GET",d+"/"+a,null,b,e)},this.createIssue=function(a,b,e){return c("POST",d,a,b,e)},this.updateIssue=function(a,b,e,f){return c("PATCH",d+"/"+a,b,e,f)},this.openIssue=function(a,b,e){return c("PATCH",d+"/"+a,{state:"open"},b,e)},this.closeIssue=function(a,b,e){return c("PATCH",d+"/"+a,{state:"closed"},b,e)}},Label:function(a,b){var d="/repos/"+a+"/"+b+"/labels";this.list=function(a,b,e){return c("GET",d,a||{},b,e)},this.getLabel=function(a,b,e){return c("GET",d+"/"+a,null,b,e)},this.createLabel=function(a,b,e){return c("POST",d,a,b,e)},this.deleteLabel=function(a,b,e){return c("DELETE",d+"/"+a,null,b,e)},this.updateLabel=function(a,b,e,f){return c("PATCH",d+"/"+a,b,e,f)}},Milestone:function(a,b){var d="/repos/"+a+"/"+b+"/milestones";this.list=function(a,b,e){return c("GET",d,a||{},b,e)},this.getMilestone=function(a,b,e){return c("GET",d+"/"+a,null,b,e)},this.createMilestone=function(a,b,e){return c("POST",d,a,b,e)},this.updateMilestone=function(a,b,e,f){return c("PATCH",d+"/"+a,b,e,f)},this.deleteMilestone=function(a,b,e){return c("DELETE",d+"/"+a,null,b,e)}}};return e}]),angular.module("ohtuProjektiAppApp").controller("BurndownCtrl",["$scope",function(a){a.myData=[10,25,15,5,50,80,13]}]),angular.module("ohtuProjektiAppApp").controller("NewissueCtrl",["$state","$scope","github","$stateParams","$modalInstance",function(a,b,c,d,e){var f=new c.Issue(d.owner,d.repoName),g=function(){a.transitionTo(a.current,d,{reload:!0,inherit:!1,notify:!0})};b.issue={},b.addIssue=function(){f.createIssue(b.issue).success(function(a,c){"201"==c&&b.issues.unshift(a),alert("Created issue: "+b.issue.title)}),g(),b.close()},b.close=function(){e.dismiss("close")}}]),angular.module("ohtuProjektiAppApp").controller("NewlabelCtrl",["$scope","github","$state","$stateParams","$modalInstance",function(a,b,c,d,e){var f=new b.Label(d.owner,d.repoName),g=function(){c.transitionTo(c.current,d,{reload:!0,inherit:!1,notify:!0})};a.createLabel=function(b){var c={name:b.name};f.createLabel(c,function(c){alert("Created label: "+b.name),a.labels.push(c)},function(){alert("Creation unsuccessful")}),a.close()},a.deleteLabel=function(b){"Ready"!==b&&"InProgress"!==b&&"Done"!==b?f.deleteLabel(b,function(){alert("Deleted label: "+b)},function(){alert("Deletion unsuccessful")}):alert("Deletion of '"+b+"' is not allowed"),g(),a.close()},a.close=function(){e.dismiss("close")}}]),angular.module("ohtuProjektiAppApp").controller("multiselectCtrl",["$scope",function(a){console.log(a),a.filtersGrouped=[]}]),angular.module("ohtuProjektiAppApp").filter("slug",function(){function a(a,b){if(!a.labels)return!1;for(var c=0;c<a.labels.length;c++)return a.labels[c].name===b?!0:!1}return function(b,c){if(!c.filtersGrouped)return[];for(var d=[],e=[],f=[],g=0;g<c.filtersGrouped.length;g++){var h=c.filtersGrouped[g];h.ticked&&("label"===h.type&&e.push(h),"milestone"===h.type&&f.push(h))}return angular.forEach(b,function(b){if(!b.milestone)return void d.push(b);for(var c=0;c<e.length;c++)if(a(b,e[c].name))return void d.push(b);for(var c=0;c<f.length;c++)if(b.milestone.title===f[c].name)return void d.push(b)}),d}});var app=angular.module("ohtuProjektiAppApp");app.directive("issuebox",function(){return{restrict:"E",templateUrl:"scripts/issueboard/issueboard.issuebox.html"}}).directive("barsChart",["$parse",function(){return{restrict:"E",replace:!1,scope:{data:"=chartData"},link:function(a,b){var c=d3.select(b[0]);c.append("div").attr("class","chart").selectAll("div").data(a.data).enter().append("div").transition().ease("elastic").style("width",function(a){return a+"%"}).text(function(a){return a+"%"})}}}]);